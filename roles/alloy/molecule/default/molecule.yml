---
dependency:
    name: galaxy
    options:
        requirements-file: requirements.yml

driver:
    name: docker

platforms:
    - name: alloy-ubuntu2204
      image: geerlingguy/docker-ubuntu2204-ansible:latest
      command: ""
      volumes:
          - /sys/fs/cgroup:/sys/fs/cgroup:rw
      cgroupns_mode: host
      privileged: true
      pre_build_image: true

    - name: alloy-ubuntu2404
      image: geerlingguy/docker-ubuntu2404-ansible:latest
      command: ""
      volumes:
          - /sys/fs/cgroup:/sys/fs/cgroup:rw
      cgroupns_mode: host
      privileged: true
      pre_build_image: true

    - name: alloy-debian12
      image: geerlingguy/docker-debian12-ansible:latest
      command: ""
      volumes:
          - /sys/fs/cgroup:/sys/fs/cgroup:rw
      cgroupns_mode: host
      privileged: true
      pre_build_image: true

provisioner:
    name: ansible
    config_options:
        defaults:
            interpreter_python: auto_silent
            callback_whitelist: profile_tasks, timer, yaml
            stdout_callback: yaml
    inventory:
        host_vars:
            alloy-ubuntu2204:
                ansible_user: root
            alloy-ubuntu2404:
                ansible_user: root
            alloy-debian12:
                ansible_user: root

verifier:
    name: ansible

scenario:
    name: default
    test_sequence:
        - dependency
        - cleanup
        - destroy
        - syntax
        - create
        - prepare
        - converge
        - idempotence
        - side_effect
        - verify
        - cleanup
        - destroy
